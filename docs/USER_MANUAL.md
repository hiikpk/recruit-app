# Hire cRaft — ユーザーマニュアル（簡易）

このドキュメントは管理者／採用担当者向けの簡易操作マニュアルです。基本的なワークフロー（候補者登録、面接の作成・録音アップロード、文字起こしの確認、AI評価の確認、設定変更）を説明します。

---

## 目次
- 概要
- ログインとダッシュボード
- 候補者の登録・確認
- 面接の作成と録音アップロード（文字起こし開始）
- 面接詳細での文字起こし・評価確認
- 設定（ヒューリスティック、データのインポート/エクスポート）
- よくある操作（一覧へ戻る、ログアウト）
- 関連ドキュメント

---

## 概要
Hire cRaft は応募管理と面接の音声解析・AI評価を行う内部ツールです。主な対象ユーザは採用担当者および管理者です。

## ログインとダッシュボード
- アクセス: `/` にアクセスするとログイン済みならダッシュボード（概要）へ移動します。未ログイン時は `/auth/login` にリダイレクトされます。
- サイドバーから主要ページへ移動できます（ホーム、ダッシュボード(拡張)、候補者、選考、設定）。

## 候補者の登録・確認
- 候補者一覧: `/candidates` で検索・フィルタが可能です。
- 新規登録: 候補者作成画面から基本情報・スキル等を入力して保存します。
- 履歴書などのファイルは候補者詳細ページからアップロード・ダウンロード・プレビューできます。
- 総合評価（AI集計）が存在する場合、候補者ヘッダに「総合スコア」ボタンが表示され、詳細ページへアクセスできます。

## 面接の作成と録音アップロード（文字起こし開始）
1. 候補者詳細や面接一覧から「選考情報を追加」で面接（Interview）を作成します。
2. 面接詳細の編集画面で録音ファイルをアップロードすると、サーバ側で `transcribe_recording` ジョブがキックされ、非同期で文字起こしが開始されます。
3. 進捗は面接詳細ページの処理ステータス（処理中/完了/失敗）が示します。

## 面接詳細での文字起こし・評価確認
- 面接詳細 `/interviews/<id>` で最新の文字起こし（全文）と AI／評価履歴、発話メトリクスを確認できます。
- 文字起こしの全文は編集可能です（保存後、Interview.transcript_text に反映されます）。
- 「全文を表示」「全文コピー」ボタンで読みやすく確認できます。
- AI評価（Evaluation）は日付順に表示され、要約（GPT）や各項目スコアが見られます。

## 設定（ヒューリスティック、データのインポート/エクスポート）
- 設定画面: `/org/settings` から組織の各種管理画面へ移動できます。
- ヒューリスティック: `/org/heuristic` で `DG_WORD_GAP_THRESHOLD`、フィラートークンなど発話解析の閾値や重みを調整できます（管理者のみ）。
- データのエクスポート/インポート: 大量データの出力（JSON）や CSV による取り込み（テンプレートあり）を行えます。

## よくある操作
- 一覧に戻る: 各詳細ページの右上やフォーム下に「一覧に戻る」ボタンがあり、ワンクリックで該当の一覧に戻れます。
- ログアウト: 設定ページ下部のログアウトカードからログアウトできます（POST）。

## 注意点・運用メモ
- 録音の文字起こしは非同期処理（RQ）で実行されます。ジョブキューとワーカーが稼働していることを確認してください。
- 設定変更（ヒューリスティック等）は解析結果に影響します。変更前に小規模で結果を確認してください。
- もし CSRF 保護を厳密に運用している場合、設定ページのログアウトフォームは適切な CSRF トークンを含める必要があります。

## 関連ドキュメント
- ルート一覧: `docs/ROUTES.md`（各ページの URL と担当テンプレートの一覧）
- 開発者向け: `app/jobs/transcribe.py`, `app/services/postprocess.py`（文字起こしと後処理の実装）

---

このファイルを `docs/USER_MANUAL.md` に保存しました。
必要であれば、より詳細な手順（スクリーンショット、API リクエスト例、権限表）を追加できます。どの部分を拡張しますか？

---

## スクリーンショットと代表的なフォームフィールド

以下は主要画面ごとの「代表的なフォーム項目一覧」とスクリーンショット挿入用のプレースホルダ情報です。
ローカルでスクリーンショットを撮影して `docs/images/` に配置すると、このマニュアルに埋め込めます（ファイル名は推奨に合わせてください）。

備考: 私の側で自動的にスクリーンショットを撮ることはできません。スクリーンショットを提供いただければ、画像を docs に追加してマニュアルを更新します。

### 共通: スクリーンショットの取り方（macOS）
- フルスクリーン撮影: Shift+Command+3
- 選択領域撮影: Shift+Command+4 → ドラッグで範囲選択
- クリップボードへ保存したい場合は Control を併用（例: Shift+Command+Control+4）
- 撮影後、画像を `docs/images/` に保存し、ファイル名を下の推奨名に合わせると挿入が簡単です。

### 1) ダッシュボード（トップ）
- 推奨画像: `docs/images/dashboard.png`
- 主な表示/操作
	- 候補者数、応募数、面接数、評価数のサマリカード
	- 30日グラフ（応募者数）
	- フィルタ（期間）
- 代表的なフォーム/パラメータ（URL クエリ）
	- `start` (YYYY-MM-DD)
	- `end` (YYYY-MM-DD)
	- `page`, `per_page`

### 2) 候補者一覧 `/candidates`
- 推奨画像: `docs/images/candidates_list.png`
- 主な表示/操作
	- 検索ボックス、状態フィルタ、流入元フィルタ、ページネーション
- 代表的なフォーム/パラメータ（URL クエリ）
	- `q` (検索キーワード)
	- `status`（applied, screening, offer など）
	- `channel`（流入元）
	- `page`, `per_page`

### 3) 候補者詳細 `/candidates/<id>`
- 推奨画像: `docs/images/candidate_detail.png`
- 主な表示/操作
	- 基本情報編集フォーム、ファイルアップロード、選考カード（面接一覧）
- 代表的なフォームフィールド
	- `name`（氏名）
	- `name_yomi`（氏名(ふりがな)）
	- `email`、`phonenumber`、`birthdate`
	- `applied_at`（応募日）、`applying_position`（応募ポジション）
	- `qualifications`, `skills`, `languages`（テキスト/JSON）
	- ファイルアップロード（resume）

### 4) 面接一覧 `/interviews`
- 推奨画像: `docs/images/interviews_list.png`
- 主な表示/操作
	- 今日の面接カード、フィルタ（開始日/終了日/ステータス）、一覧表示
- 代表的なフォーム/パラメータ（URL クエリ）
	- `start`, `end`, `status`, `tz`（クライアントの timezone offset）

### 5) 面接作成 / 編集 `/interviews/create`, `/interviews/<id>`
- 推奨画像: `docs/images/interview_detail.png`
- 主なフォームフィールド（編集・作成フォーム）
	- `candidate_id`（候補者ID）
	- `scheduled_at`（日時）
	- `step`（document/first/second/final）
	- `status`（状態）、`result`（合否）
	- `interviewer`（面接担当者）
	- `comment`（評価コメント）
	- `file`（録音ファイルアップロード）
	- `transcript_text`（文字起こし全文の編集）
- 操作メモ: 録音をアップロードすると非同期で文字起こしジョブがキックされます。編集画面の「キャンセル」は一覧へ戻るようになっています。

### 6) 面接詳細（表示） `/interviews/<id>`
- 推奨画像: `docs/images/interview_view.png`
- 主な表示/操作
	- AI 評価カード一覧、話し方メトリクス、文字起こし全文（折りたたみ／コピー）
	- ICS ダウンロードボタン（予定の iCal）

### 7) 設定（管理） `/org/settings` とサブページ
- 推奨画像: `docs/images/org_settings.png`
- 主なサブページと代表フィールド
	- `/org/heuristic` — `HEURISTIC_WEIGHT_AI`, `HEURISTIC_WEIGHT_H`, `DG_WORD_GAP_THRESHOLD`, `FILLER_TOKENS`
	- `/org/export` — エクスポート対象チェックボックス（candidates, interviews, evaluations など）
	- `/org/import` — CSV ファイル選択フィールド (`file`)、テンプレートダウンロードリンク
	- `/org/users` — 各ユーザの `tz_<id>` 入力フィールド（タイムゾーンオフセット）
	- 設定ページ下部にログアウトボタンを配置済み（POST）。

### 8) ジョブ API（管理者向け）
- 推奨画像: `docs/images/jobs_api.png`（任意）
- 代表エンドポイント
	- `POST /jobs/evaluate` — body: `{ "application_id": <int> }`（enqueue）
	- `POST /jobs/notify` — body: `{ "application_id": <int>, "to": "...", "subject":"...", "html":"..." }`

## 画像を提供する場合の手順
1. 各画面をブラウザで表示する。2. 指定した推奨ファイル名でスクリーンショットを撮影する（上記参照）。3. ルート `docs/images/` を作成して画像を配置する（例: `docs/images/interview_view.png`）。4. 画像を配置した旨を教えていただければ、私が Markdown に埋め込み（`![](...)`）して更新します。

---

追加で欲しい出力形式（PDF、スライド、または HTML 化）や、特定画面のフォーム仕様書（フィールドのバリデーション、型、DB カラム対応）を指定してください。
