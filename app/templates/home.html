{% extends "layout.html" %}
{% block title %}ダッシュボード{% endblock %}
{% block breadcrumbs %}ダッシュボード / <strong>全体</strong>{% endblock %}
{% block content %}
<div class="toolbar">
  <div class="title">応募概要</div>
  <div class="filters">
    <form id="rangeForm" method="get">
      <label>期間
        <input type="date" name="start" value="{{ request.args.get('start', '') }}"> ～
        <input type="date" name="end" value="{{ request.args.get('end', '') }}">
      </label>
      <button class="btn-ghost" type="submit">更新</button>
    </form>
  </div>
</div>

<!-- KPIカード -->
<div class="kpi-grid">
  <div class="kpi-card">アクティブ数<br><strong>{{ stats.candidates }}</strong></div>
  <div class="kpi-card">選択期間中の応募者数<br><strong>{{ series.applicants | sum }}</strong></div>
  <div class="kpi-card">本日の面接数<br><strong>{{ stats.interviews }}</strong></div>
  <div class="kpi-card">選択期間中の内定承諾者数<br><strong>{{ series.hires | sum if series.hires is defined else 0 }}</strong></div>
</div>

<!-- 2つのグラフ（応募推移＝折れ線、合格推移＝棒） -->
<div class="panel-grid">
  <div class="panel">
    <h4 class="panel-title">応募者数（日別）</h4>
    <div class="chart-container"><canvas id="lineApplicants"></canvas></div>
  </div>
  <div class="panel">
    <h4 class="panel-title">入社人数（月別）</h4>
    <div class="chart-container"><canvas id="barHires"></canvas></div>
  </div>
</div>

<script>
  // サーバから提供されるサンプルデータ
  const labels = {{ series.labels | tojson }};
  const applicants = {{ series.applicants | tojson }};
  const hiresMonths = {{ series.hires_months | tojson }};
  const hires = {{ series.hires | tojson }};

  // 応募（折れ線）
  new Chart(document.getElementById('lineApplicants'), {
    type: 'line',
    data: {
      labels,
      datasets: [{
        label: '応募',
        data: applicants,
        tension: 0.35,
        borderWidth: 2,
        pointRadius: 3,
        pointHoverRadius: 5,
        borderColor: '#2196f3',
        backgroundColor: 'rgba(33,150,243,0.12)',
        fill: true
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      interaction: { mode: 'index', intersect: false },
      plugins: { legend: { position: 'top' } },
      scales: {
        x: { grid: { display: false }, ticks: { maxRotation: 0, autoSkip: true } },
        y: { beginAtZero: true, grid: { color: 'rgba(13,71,161,0.08)' } }
      },
      layout: { padding: { left: 8, right: 8, top: 4, bottom: 0 } }
    }
  });

  // 入社人数（月別）
  new Chart(document.getElementById('barHires'), {
    type: 'bar',
    data: {
      labels: hiresMonths,
      datasets: [{
        label: '入社予定',
        data: hires,
        borderWidth: 1.5,
        borderRadius: 6,
        backgroundColor: 'rgba(76,175,80,0.35)',
        borderColor: '#4caf50'
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      interaction: { mode: 'index', intersect: false },
      plugins: { legend: { position: 'top' } },
      scales: {
        x: { grid: { display: false } },
        y: { beginAtZero: true, grid: { color: 'rgba(13,71,161,0.08)' } }
      },
      layout: { padding: { left: 8, right: 8, top: 4, bottom: 0 } }
    }
  });
</script>
{% endblock %}