{% extends "layout.html" %}
{% block title %}候補者一覧{% endblock %}
{% block breadcrumbs %}候補者 / <strong>一覧</strong>{% endblock %}
{% block content %}
<form method="get" style="display:flex; gap:8px; align-items:center; margin-bottom:10px">
  <input type="text" name="q" placeholder="氏名検索" value="{{ request.args.get('q','') }}">
  <input type="date" name="applied_at" value="{{ request.args.get('applied_at','') }}">
  <input type="text" name="applying_position" placeholder="ポジション" value="{{ request.args.get('applying_position','') }}">
  <input type="text" name="nationality" placeholder="国籍" value="{{ request.args.get('nationality','') }}">
  <select name="status">
    <option value="">すべてのステータス</option>
    <option value="applied" {% if request.args.get('status')=='applied' %}selected{% endif %}>新着応募</option>
    <option value="screening" {% if request.args.get('status')=='screening' %}selected{% endif %}>選考中</option>
    <option value="offer" {% if request.args.get('status')=='offer' %}selected{% endif %}>内定</option>
    <option value="hired" {% if request.args.get('status')=='hired' %}selected{% endif %}>入社</option>
    <option value="rejected" {% if request.args.get('status')=='rejected' %}selected{% endif %}>不採用</option>
    <option value="withdrawn" {% if request.args.get('status')=='withdrawn' %}selected{% endif %}>辞退</option>
  </select>
  <input type="text" name="channel" placeholder="流入元" value="{{ request.args.get('channel','') }}">
  <button type="submit">絞込</button>
  <a href="/candidates/create">新規作成</a>
</form>
{% if new_apps and new_apps|length > 0 %}
<section class="card" style="margin-bottom:12px">
  <h4 class="card-title">新着応募（{{ new_apps|length }}）</h4>
  <div style="display:flex; gap:10px; flex-wrap:wrap">
    {% for c in new_apps %}
      <div class="card" style="min-width:220px; max-width:320px; padding:10px">
        <div style="font-weight:bold"><a class="link" href="{{ url_for('candidates.detail', candidate_id=c.id) }}">{{ c.name }}</a></div>
        <div style="margin-top:6px">応募日: {{ c.applied_at.strftime('%Y/%m/%d') if c.applied_at else '-' }}</div>
        <div>ポジション: {{ c.applying_position or '-' }}</div>
        <div style="margin-top:8px">ステータス: {{ c.status or '-' }}</div>
      </div>
    {% endfor %}
  </div>
</section>
{% endif %}

<table>
  <tr><th>ID</th><th>応募日</th><th>氏名</th><th>選考ポジション</th><th>国籍</th><th>ステータス</th></tr>
  {% for c in items %}
  <tr>
    <td>{{ c.id }}</td>
    <td>{{ c.applied_at.strftime('%Y-%m-%d') if c.applied_at else '—' }}</td>
    <td><a href="{{ url_for('candidates.detail', candidate_id=c.id) }}" class="link">{{ c.name }}</a></td>
    <td>{{ c.applying_position }}</td>
    <td>{{ c.nationality }}</td>
    <td>
      {% set status_map = {'applied':'新着応募','screening':'選考中','offer':'内定','hired':'入社','rejected':'不採用','withdrawn':'辞退'} %}
      {{ status_map.get(c.status, '—') }}
    </td>
  </tr>
  {% endfor %}
</table>

{% if pagination and pagination.pages and pagination.pages > 1 %}
<div style="margin-top:12px; display:flex; gap:8px; align-items:center">
  {% if pagination.has_prev %}
    <a class="btn-ghost" href="{{ make_page_url(pagination.prev_num) }}">前へ</a>
  {% endif %}
  <span>ページ {{ pagination.page }} / {{ pagination.pages }}</span>
  {% for p in range(1, pagination.pages + 1) %}
    {% if p == pagination.page %}
      <strong>{{ p }}</strong>
    {% else %}
      <a class="btn-ghost" href="{{ make_page_url(p) }}">{{ p }}</a>
    {% endif %}
  {% endfor %}
  {% if pagination.has_next %}
    <a class="btn-ghost" href="{{ make_page_url(pagination.next_num) }}">次へ</a>
  {% endif %}
</div>
{% endif %}
{% endblock %}